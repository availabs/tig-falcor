#!/usr/bin/env node

const { mkdirSync } = require("fs");
const { join } = require("path");

const falcorGraph = require("../utils/graph");
const logDbQueries = require("../utils/logDbQueries");

const logsDir = join(__dirname, "../logs");
const logPath = join(logsDir, "conflationTmcData.ndjson");

mkdirSync(logsDir, { recursive: true });

logDbQueries(logPath);

const getQueryParams = (paths) => ({
  queryStringParameters: {
    paths,
    method: "get",
  },
});

const pathSet = [
  "conflation",
  "tmc",
  [
    "120+09540",
    "120-09541",
    "120+09543",
    "120-09542",
    "120-09543",
    "120+09542",
    "120-09558",
    "120+09558",
    "120-09554",
    "120+09554",
    "120+09555",
    "120-09559",
    "120+09559",
    "120-09967",
    "120+09968",
    "120+09967",
    "120-09968",
    "120+10218",
    "120-10225",
    "120-10226",
    "120+10227",
    "120+10225",
    "120+10226",
    "120-11205",
    "120+11204",
    "120-11204",
    "120+11205",
    "120+11207",
    "120+11206",
    "120-11206",
    "120-11262",
    "120-11263",
    "120+11266",
    "120+11264",
    "120+11263",
    "120+11265",
    "120-11266",
    "120-11264",
    "120-11265",
    "120+11269",
    "120-11270",
    "120-11269",
    "120-11267",
    "120+11268",
    "120+11267",
    "120-11268",
    "120+11271",
    "120+11270",
    "120-11271",
    "120+11272",
    "120-11272",
    "120-11273",
    "120-11274",
    "120+11275",
    "120+11273",
    "120-11275",
    "120-11277",
    "120-11276",
    "120+11274",
    "120+11276",
    "120+11278",
    "120+11277",
    "120+11340",
    "120-11340",
    "120-11339",
    "120+11339",
    "120-11343",
    "120+11343",
    "120-11357",
    "120+11409",
    "120-11409",
    "120+11357",
    "120+11573",
    "120+11572",
    "120-11572",
    "120-11571",
    "120-11573",
    "120+11576",
    "120-11574",
    "120+11574",
    "120-11576",
    "120+11575",
    "120-11575",
    "120+11671",
    "120-11673",
    "120-11671",
    "120-11672",
    "120+11672",
    "120+11673",
    "120+11674",
    "120-11674",
    "120-11843",
    "120-11845",
    "120+11844",
    "120+11845",
    "120-11844",
    "120+11849",
    "120+11846",
    "120-11846",
    "120+11847",
    "120+11848",
    "120-11848",
    "120-11847",
    "120-11849",
    "120+11853",
    "120+11850",
    "120+11851",
    "120-11851",
    "120+11852",
    "120-11850",
    "120-11852",
    "120-11853",
    "120-11854",
    "120-11856",
    "120+11856",
    "120+11854",
    "120+11855",
    "120-11855",
    "120-11930",
    "120+11931",
    "120-11931",
    "120-11932",
    "120+11932",
    "120+11933",
    "120-11936",
    "120-11935",
    "120-11934",
    "120-11933",
    "120+11934",
    "120+11935",
    "120-11939",
    "120+11937",
    "120-11937",
    "120+11938",
    "120+11939",
    "120-11938",
    "120+11936",
    "120-11943",
    "120+11940",
    "120+11942",
    "120-11942",
    "120+11941",
    "120-11941",
    "120-11940",
    "120-11945",
    "120-11944",
    "120-11946",
    "120+11946",
    "120+11945",
    "120+11944",
    "120+11943",
    "120+11947",
    "120-12005",
    "120+12004",
    "120-12003",
    "120-12004",
    "120+12003",
    "120-12008",
    "120-12007",
    "120+12007",
    "120-12006",
    "120+12006",
    "120+12005",
    "120+12009",
    "120+12011",
    "120-12011",
    "120-12009",
    "120-12010",
    "120+12010",
    "120+12008",
    "120-12012",
    "120+12012",
    "120+12013",
    "120-12013",
    "120+12014",
    "120-12014",
    "120-12072",
    "120+12072",
    "120-12075",
    "120-12073",
    "120+12075",
    "120+12074",
    "120+12073",
    "120-12074",
    "120+12080",
    "120+12079",
    "120-12079",
    "120-12080",
    "120-12081",
    "120+12083",
    "120-12083",
    "120-12084",
    "120-12082",
    "120+12082",
    "120+12081",
    "120+12086",
    "120+12084",
    "120-12087",
    "120+12087",
    "120-12086",
    "120-12085",
    "120+12085",
    "120-12090",
    "120+12090",
    "120-12088",
    "120+12088",
    "120-12089",
    "120+12089",
    "120+12094",
    "120+12092",
    "120+12093",
    "120-12094",
    "120-12091",
    "120+12091",
    "120-12093",
    "120-12092",
    "120-12100",
    "120+12095",
    "120-12096",
    "120-12095",
    "120+12096",
    "120+12103",
    "120+12101",
    "120+12102",
    "120-12103",
    "120-12102",
    "120+12104",
    "120-12104",
    "120-12101",
    "120+12100",
    "120-12106",
    "120-12105",
    "120+12105",
    "120+12106",
    "120+12125",
    "120-12125",
    "120-12126",
    "120-12128",
    "120+12127",
    "120-12127",
    "120+12128",
    "120+12126",
    "120-12129",
    "120+12129",
    "120-12145",
    "120+12147",
    "120-12147",
    "120-12146",
    "120-12148",
    "120+12146",
    "120+12145",
    "120-12144",
    "120+12151",
    "120-12151",
    "120+12148",
    "120-12150",
    "120+12149",
    "120-12149",
    "120+12150",
    "120-12152",
    "120+12152",
    "120-12154",
    "120-12155",
    "120-12153",
    "120+12153",
    "120+12154",
    "120+12158",
    "120+12155",
    "120+12157",
    "120-12157",
    "120-12158",
    "120-12156",
    "120+12156",
    "120-12159",
    "120+12160",
    "120+12161",
    "120-12160",
    "120-12161",
    "120+12159",
    "120-12162",
    "120+12162",
    "120-12267",
    "120-12266",
    "120-12268",
    "120+12267",
    "120+12269",
    "120-12272",
    "120-12271",
    "120+12270",
    "120-12270",
    "120-12269",
    "120+12268",
    "120+12271",
    "120+12272",
    "120-12275",
    "120-12273",
    "120+12274",
    "120+12273",
    "120-12274",
    "120+12275",
    "120-12277",
    "120+12276",
    "120+12277",
    "120-12278",
    "120+12278",
    "120-12276",
    "120+12281",
    "120+12280",
    "120-12281",
    "120-12280",
    "120+12279",
    "120-12279",
    "120-12282",
    "120+12282",
    "120+12283",
    "120+12284",
    "120+12285",
    "120-12285",
    "120-12283",
    "120-12284",
    "120-12286",
    "120-12287",
    "120+12286",
    "120+12287",
    "120-12288",
    "120+12288",
    "120-12291",
    "120+12291",
    "120+12289",
    "120-12289",
    "120-12292",
    "120+12290",
    "120-12290",
    "120+12294",
    "120-12293",
    "120+12293",
    "120+12292",
    "120-12294",
    "120-12295",
    "120-12296",
    "120+12295",
    "120+12298",
    "120-12300",
    "120+12296",
    "120+12300",
    "120+12297",
    "120-12298",
    "120-12299",
    "120-12297",
    "120+12299",
    "120+12301",
    "120+12487",
    "120-12487",
    "120+12488",
    "120-12488",
    "120+12489",
    "120-12489",
    "120+12490",
    "120-12490",
    "120+12491",
    "120+12492",
    "120+12493",
    "120-12492",
    "120-12491",
    "120-12493",
    "120+12494",
    "120-12506",
    "120-12509",
    "120+12508",
    "120+12510",
    "120+12507",
    "120-12507",
    "120+12509",
    "120-12508",
    "120+12526",
    "120-12527",
    "120-12526",
    "120+12530",
    "120-12530",
    "120+12529",
    "120-12529",
    "120+12527",
    "120-12528",
    "120+12528",
    "120-12543",
    "120-12541",
    "120+12542",
    "120-12542",
    "120+12543",
    "120+12544",
    "120+12545",
    "120+12546",
    "120-12546",
    "120-12545",
    "120-12544",
    "120-12547",
    "120-12551",
    "120-12550",
    "120+12549",
    "120+12550",
    "120+12547",
    "120+12548",
    "120-12548",
    "120-12549",
    "120+12554",
    "120+12552",
    "120-12552",
    "120-12553",
    "120+12551",
    "120+12553",
    "120+12570",
    "120-12582",
    "120-12580",
    "120+12582",
    "120-12581",
    "120-12583",
    "120+12581",
    "120+12761",
    "120-12759",
    "120-12761",
    "120-12760",
    "120-12762",
    "120+12760",
    "120+12759",
    "120+12762",
    "120+12763",
    "120-12763",
    "120-12764",
    "120+12766",
    "120-12766",
    "120+12765",
    "120+12764",
    "120-12765",
    "120+12767",
    "120+12892",
    "120-12891",
    "120+12893",
    "120-12892",
    "120-12903",
    "120-12907",
    "120+12908",
    "120-12906",
    "120+12907",
    "120-12905",
    "120+12906",
    "120-12908",
    "120+12904",
    "120+12909",
    "120-12909",
    "120-12925",
    "120-12928",
    "120+12927",
    "120-12927",
    "120-12926",
    "120+12926",
    "120+12928",
    "120+12929",
    "120+12930",
    "120+12931",
    "120-12930",
    "120-12931",
    "120-12929",
    "120+13287",
    "120-13287",
    "120-13286",
    "120+13286",
    "120-13292",
    "120-13291",
    "120+13291",
    "120+13302",
    "120-13302",
    "120+13292",
    "120-13303",
    "120+13311",
    "120-13311",
    "120+13303",
    "120+13369",
    "120-13369",
    "120+13376",
    "120-13376",
    "120-13391",
    "120+13391",
    "120-13664",
    "120-13677",
    "120+13678",
    "120-13678",
    "120-13679",
    "120+13680",
    "120-13681",
    "120-13680",
    "120+13679",
    "120+13681",
    "120+13780",
    "120-13777",
    "120+13781",
    "120-13780",
    "120-13779",
    "120-13781",
    "120+13782",
    "120-13820",
  ],
  "data",
  2019,
  [
    "RIS_aadt_current_yr_est",
    "TMC_aadt",
    "TMC_frc",
    "TMC_miles",
    "lottr",
    "pct_bins_reporting_am",
    "pct_bins_reporting_off",
    "pct_bins_reporting_pm",
  ],
];

const run = async () => {
  try {
    const d = await falcorGraph.respond(getQueryParams([pathSet]));
    console.log(JSON.stringify(d, null, 4));
  } catch (err) {
    console.error(err);
  }

  falcorGraph.close();
};

run();
